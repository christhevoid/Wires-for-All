(()=>{function e(){return window.unifiedSDK}function t(e){return new Proxy(e,{set:()=>!0,get:(e,n)=>{const r=e[n];return"object"==typeof r&&null!==r?t(r):r}})}function n(e={}){return new Promise(((t,n)=>{if("function"!=typeof(e={task:null,maxRunTasks:2500,maxRunDuration:25,...e}).task)return n("task needs to be a callback function");const i=r(e.maxRunTasks),a=o(e.maxRunDuration);let s=!1;const d=async()=>{if(!s){if(i.limitReached()||a.limitReached())return i.reset(),a.reset(),void setTimeout(d,0);a.start(),i.increase();try{await e.task(l),d()}catch(e){s=!0,n(e)}}},l=(e=null)=>{s=!0,t(e)};setTimeout(d,0)}))}function r(e=null){const t={};let n=0;return t.getCount=()=>n,t.increase=(e=1)=>n+=e,t.decrease=(e=1)=>n-=e,t.reset=()=>n=0,t.limitReached=()=>null!==e&&n>=e,t}function o(e=null){const t={};let n=null;return t.start=()=>{null===n&&(n=Date.now())},t.getDuration=()=>n?Date.now()-n:0,t.reset=()=>n=null,t.limitReached=()=>null!==n&&null!==e&&t.getDuration()>=e,t}const i=15;async function a(e){if(null==e)return"";var t,r,o={},a={},d="",l="",c="",u=2,g=3,f=2,h=[],p=0,m=0,y=0;if(await n({maxRunDuration:40,task:n=>{for(var w=0;w<7500;w++){if(d=e.charAt(y),Object.prototype.hasOwnProperty.call(o,d)||(o[d]=g++,a[d]=!0),l=c+d,Object.prototype.hasOwnProperty.call(o,l))c=l;else{if(Object.prototype.hasOwnProperty.call(a,c)){if(c.charCodeAt(0)<256){for(t=0;t<f;t++)p<<=1,m==i-1?(m=0,h.push(s(p)),p=0):m++;for(r=c.charCodeAt(0),t=0;t<8;t++)p=p<<1|1&r,m==i-1?(m=0,h.push(s(p)),p=0):m++,r>>=1}else{for(r=1,t=0;t<f;t++)p=p<<1|r,m==i-1?(m=0,h.push(s(p)),p=0):m++,r=0;for(r=c.charCodeAt(0),t=0;t<16;t++)p=p<<1|1&r,m==i-1?(m=0,h.push(s(p)),p=0):m++,r>>=1}0==--u&&(u=Math.pow(2,f),f++),delete a[c]}else for(r=o[c],t=0;t<f;t++)p=p<<1|1&r,m==i-1?(m=0,h.push(s(p)),p=0):m++,r>>=1;0==--u&&(u=Math.pow(2,f),f++),o[l]=g++,c=String(d)}if(++y>=e.length)return n()}}}),""!==c){if(Object.prototype.hasOwnProperty.call(a,c)){if(c.charCodeAt(0)<256){for(t=0;t<f;t++)p<<=1,m==i-1?(m=0,h.push(s(p)),p=0):m++;for(r=c.charCodeAt(0),t=0;t<8;t++)p=p<<1|1&r,m==i-1?(m=0,h.push(s(p)),p=0):m++,r>>=1}else{for(r=1,t=0;t<f;t++)p=p<<1|r,m==i-1?(m=0,h.push(s(p)),p=0):m++,r=0;for(r=c.charCodeAt(0),t=0;t<16;t++)p=p<<1|1&r,m==i-1?(m=0,h.push(s(p)),p=0):m++,r>>=1}0==--u&&(u=Math.pow(2,f),f++),delete a[c]}else for(r=o[c],t=0;t<f;t++)p=p<<1|1&r,m==i-1?(m=0,h.push(s(p)),p=0):m++,r>>=1;0==--u&&(u=Math.pow(2,f),f++)}for(r=2,t=0;t<f;t++)p=p<<1|1&r,m==i-1?(m=0,h.push(s(p)),p=0):m++,r>>=1;for(;;){if(p<<=1,m==i-1){h.push(s(p));break}m++}return h.join("")+" "}function s(e){return String.fromCharCode(e+32)}const d=JSON.parse('{"load":{"id":1,"dataOrder":["type","eventType","time"]},"connectTime":{"id":2,"dataOrder":["type","clientTime",null,"time"]},"resize":{"id":3,"dataOrder":["type","deltaWindowWidth","deltaWindowHeight","time","deltaClientWidth","deltaClientHeight","windowWidth","windowHeight","clientWidth","clientHeight"]},"scroll":{"id":4,"dataOrder":["type","deltaLeft","deltaTop","time"],"logLevel":false},"scaleChange":{"id":6,"dataOrder":["type","clientWidth","clientHeight","time",0,0,0,"pageXOffset","pageYOffset"]},"mousedown":{"id":7,"dataOrder":["type","buttonId","modKey","pageX","pageY","time","tagName","id","href","anticlickmap","xpath","position","dimensions","dimensionPath","nodeId"]},"elementScroll":{"id":8,"dataOrder":["type","scrollLeft","scrollTop","time","nodeId","xPath"]},"mousemove":{"id":9,"dataOrder":["type","buttonId","modKey","pageX","pageY","time"],"logLevel":false},"property":{"id":10,"dataOrder":["type","name","value","time","scope","dataType","unique"],"logLevel":"debug"},"keydown":{"id":11,"dataOrder":["type","keyCode","modKey","time","key"]},"orientationChange":{"id":12,"dataOrder":["type","orientation",null,"time"]},"initPage":{"id":13,"dataOrder":["type","revision","PID","VID","idsite","starttime","url","viewport","res","scrollHeight","referer","flashVer","enginePolls","ua","domloadTime","scrollWidth","locale","clientWidth","pagename","scrollTop","versions","debugMessages","virtualPi","outerViewport","availableViewport","isTouch","extendedProperties","trackingPersistence"]},"mutation":{"id":14,"dataOrder":["type","mutationData","mutationId","time","mutationSize"],"logLevel":false},"snapshot":{"id":15,"dataOrder":["type","0","snapshot","time","snapshotSize"],"logLevel":false},"reconnect":{"id":16,"dataOrder":["type","PID","0","time"]},"ping":{"id":17,"dataOrder":["type"],"logLevel":false},"blur":{"id":18,"dataOrder":["type","fieldValue",null,"time","nodeId"]},"focus":{"id":19,"dataOrder":["type","fieldId","fieldName","time","formId","fieldValue","fieldMptId","formName","formMptId","fieldType","tagName","XPath","nodeId"]},"pagehide":{"id":21,"dataOrder":["type",null,null,"time"]},"areaVisibility":{"id":27,"dataOrder":["type","firstArea","countAreas","time"]},"change":{"id":30,"dataOrder":["type","fieldId","fieldName","time","formId","fieldValue","fieldMptId","formName","formMptId","tagName"]},"touchstart":{"id":32,"dataOrder":["type","fingerId","screenX","time","screenY","pageX","pageY","clientX","clientY","force","angle","radiusX","radiusY","tagName","id","href","anticlickmap","xpath"]},"touchmove":{"id":33,"dataOrder":["type","fingerId","screenX","time","screenY","pageX","pageY","clientX","clientY","force","angle","radiusX","radiusY"],"logLevel":false},"touchend":{"id":34,"dataOrder":["type","fingerId","screenX","time","screenY","pageX","pageY","clientX","clientY"]},"touchcancel":{"id":35,"dataOrder":["type","fingerId","screenX","time","screenY","pageX","pageY","clientX","clientY"]},"gesturestart":{"id":36,"dataOrder":["type","scale","rotation","time","tagName","nodeId"]},"gesturechange":{"id":37,"dataOrder":["type","scale","rotation","time"]},"gestureend":{"id":38,"dataOrder":["type","scale","rotation","time"]},"scrollHeight":{"id":40,"dataOrder":["type","scrollHeight","time"]},"activateSession":{"id":43,"dataOrder":["type","time","recordingType"]},"fieldChange":{"id":50,"dataOrder":["type","jsonData","time"]},"scriptErrors":{"id":51,"dataOrder":["type","jsonData","time"]},"domLoaded":{"id":52,"dataOrder":["type","jsonData","time"]},"tabFocus":{"id":53,"dataOrder":["type","jsonData","time"]}}');function l(e={}){const{maxRetries:t=5,retryDelay:n=250,handler:r=null,onSuccess:o=null,onFail:i=null,onRetry:a=null}=e;let s=0;if("function"!=typeof r)throw new Error("Invalid Argument: handler is required to be a function");const d=()=>{let e=!1;const l=(r=!0,l=null)=>{e||(e=!0,r?null!==o&&o(l):s<t?(s++,null!==a&&a(l),setTimeout(d,n)):null!==i&&i(l))};try{r(l)}catch(e){l(!1,e)}};return d}function c(e={}){return new u(e)}class u{constructor(e={}){this.options={maxRunItems:750,maxRunDuration:25,maxRetries:5,retryDelay:50,onError:null,...e},this.callLimit=r(this.options.maxRunItems),this.durationLimit=o(this.options.maxRunDuration),this.reset()}start(){this.active=!0,this.requestProcessing()}pause(){this.active=!1}push(e){if("function"!=typeof e)throw new Error("task must be a function");this.flushing||(this.tasks.push(e),this.requestProcessing())}flush(e=null){this.flushing=!0,this.requestProcessing();const t=setInterval((()=>{0!==this.tasks.length||this.busy||(this.flushing=!1,clearInterval(t),null!==e&&e())}),1)}reset(){clearTimeout(this.currentRequestTimeout),this.tasks=[],this.active=!1,this.busy=!1,this.flushing=!1,this.retries=0,this.currentRequestTimeout=null,this.callLimit.reset(),this.durationLimit.reset()}requestProcessing(){if(!this.active||this.busy||0===this.tasks.length)return;if(this.callLimit.limitReached())return this.callLimit.reset(),this.durationLimit.reset(),void(this.currentRequestTimeout=setTimeout(this.requestProcessing.bind(this),0));if(this.durationLimit.limitReached()&&!this.flushing)return this.callLimit.reset(),this.durationLimit.reset(),void(this.currentRequestTimeout=setTimeout(this.requestProcessing.bind(this),0));this.busy=!0;const e=this.tasks.shift();let t=!1;const n=(e=!0,n=null)=>{t||(t=!0,e||null===this.options.onError||this.options.onError(n),this.busy=!1,this.requestProcessing())};l({maxRetries:this.flushing?0:this.options.maxRetries,retryDelay:this.options.retryDelay,handler:t=>{this.durationLimit.start(),this.callLimit.increase(),e(t)},onRetry:()=>{this.callLimit.reset(),this.durationLimit.reset()},onSuccess:()=>n(!0),onFail:(e=null)=>n(!1,e)})()}}function g(e=null){const t={},n=new Set;let r,o=!1;return t.subscribe=i=>{if("function"!=typeof i)throw new Error("Invalid Argument: subscribe needs to be called with a function");return n.add(i),o||(o=!0,"function"==typeof e&&(r=e(t.next))),()=>{if(n.delete(i),0===n.size)return t.dispose()}},t.next=e=>{n.forEach((t=>{t(e)}))},t.pipe=(...e)=>{if(0===e.length)throw new Error("No pipe callback provided");let n=t;return e.forEach((e=>{if("function"!=typeof e)throw new Error("Invalid Argument: pipe can only be called with functions");const t=n;n=g((n=>t.subscribe((t=>e(t,n)))))})),n},t.dispose=async()=>{n.clear(),o=!1,r instanceof Promise&&(r=await r),"function"==typeof r&&await r()},t}function f(e){if("function"!=typeof e)throw new Error("Invalid Argument: filter needs to be called with a function");return(t,n)=>{e(t)&&n(t)}}function h(e){if("function"!=typeof e)throw new Error("Invalid Argument: map needs to be called with a function");return(t,n)=>{n(e(t))}}function p(...e){return g((t=>{const n=e.map((e=>e.subscribe(t)));return()=>{n.forEach((e=>e()))}}))}function m(e,t,...n){return g((r=>{const o=e=>{try{r(e)}catch(e){}};return t.forEach((t=>e.addEventListener(t,o,...n))),()=>{t.forEach((t=>e.removeEventListener(t,o)))}}))}function y(e){let t,n=[];return(r,o)=>{n.push(r),clearTimeout(t),t=setTimeout((()=>{o(n),n=[]}),e)}}function w({socketConnector:n,localBuffer:r,visitor:o,tracker:i=[]}={}){const{logger:a}=e(),s={},l=c(),u=p(...i),g={useBuffer:!1,collecting:!1};return s.state=t(g),s.startEventCollection=async({useBuffer:e=!1})=>{g.collecting||(g.useBuffer=e,g.useBuffer?await r.connectLocalBuffer():n.isConnected()||await n.connectSocket(),l.start(),u.subscribe(s.collectEvent),g.collecting=!0)},s.collectEvent=({event:e,data:t={}})=>{!function(e,t){const n=d[e];let r=n.logLevel;if(!1===r)return;"function"!=typeof a[r]&&(r="debug");a[r]("Event:",e,t)}(e,t),t.time=o.getPageTime(),l.push((o=>{const i=b(e,t);g.useBuffer?r.pushEvent(i):n.pushEvent(i),o()}))},s.stopEventCollection=async()=>{l.pause(),u.dispose(),g.useBuffer?await r.disconnectLocalBuffer():n.disconnectSocket(),g.collecting=!1},s.transitionToServer=async()=>{g.useBuffer&&(l.pause(),await n.connectSocket(),await r.flushToSocket(n),await r.disconnectLocalBuffer(),g.useBuffer=!1,l.start())},s}function b(e,t={}){if(!d.hasOwnProperty(e))throw new Error(`Invalid Argument: Event type "${e}" is not supported`);const n=d[e],r=n.dataOrder;return t.type=n.id,r.map((e=>t.hasOwnProperty(e)?"boolean"==typeof t[e]?+t[e]:"jsonData"===e&&"object"==typeof t[e]?JSON.stringify(t[e]):t[e]:e))}async function v(t){const{logger:n}=e();try{15===t[0]&&"{"===t[2][0]&&(t[2]=await a(t[2])),14===t[0]&&"{"===t[1][0]&&(t[1]=await a(t[1]))}catch(e){n.warn("Error while compressing with lz string. Using uncompressed data instead.",e)}return t}function N({databaseName:t,databaseVersion:n,upgrades:r=[]}){const o={},{logger:i}=e();let a=null;if("string"!=typeof t)throw new Error("Invalid Argument: databaseName has to be a string, got: "+typeof t);if("number"!=typeof n)throw new Error("Invalid Argument: databaseVersion has to be a number, got: "+typeof n);return o.openDatabase=()=>a?Promise.resolve(a):new Promise(((e,o)=>{const s=window.indexedDB.open(t,n);s.onupgradeneeded=async({target:e,oldVersion:n,newVersion:o})=>{i.info(`indexedDB "${t}" v${n} needs upgrade to v${o}`),a=e.result;for(const e in r){const s=Number(e)+1,d=r[e];s>n&&s<=o&&(await d(a),i.info(`indexedDB "${t}" upgraded to v${s}`))}},s.onsuccess=({target:n})=>{i.debug(`indexedDB "${t}" opened`),a=n.result,e(a)},s.onerror=e=>o(e.error),s.onclose=()=>{i.debug(`indexedDB "${t}" closed`),a=null}})),o.closeDatabase=()=>{a&&(a.close(),a=null)},o.isConnected=()=>!!a,o.getDatabase=()=>a,o.deleteDatabase=async()=>(await o.closeDatabase(),C(window.indexedDB.deleteDatabase(t))),o.getObjectStore=e=>function(e,t){const n={};return n.runTransaction=(n,r,o={})=>{const i=e.getDatabase();if(!i)throw new Error("Can't run transaction. IndexedDB is not connected");const a=i.transaction(t,n,o);return r(a.objectStore(t),a)},n.add=(e,t=null)=>n.runTransaction("readwrite",(n=>C(n.add(e,t)))),n.clear=()=>n.runTransaction("readwrite",(e=>C(e.clear()))),n.count=e=>n.runTransaction("readonly",(t=>C(t.count(e)))),n.delete=e=>n.runTransaction("readwrite",(t=>C(t.delete(e)))),n.get=e=>n.runTransaction("readonly",(t=>C(t.get(e)))),n.getAll=(e,t)=>n.runTransaction("readonly",(n=>C(n.getAll(e,t)))),n.getAllKeys=(e,t)=>n.runTransaction("readwrite",(n=>C(n.getAllKeys(e,t)))),n.getKey=e=>n.runTransaction("readwrite",(t=>C(t.getKey(e)))),n.openCursor=(e,t,{query:r=null,direction:o="next"}={})=>n.runTransaction(e,(e=>E(e.openCursor(r,o),t))),n.openKeyCursor=(e,t,{query:r=null,direction:o="next"}={})=>n.runTransaction(e,(e=>E(e.openKeyCursor(r,o),t))),n.put=(e,t)=>n.runTransaction("readwrite",(n=>C(n.put(e,t)))),n}(o,e),o}function C(e){return new Promise(((t,n)=>{e.onsuccess=e=>t(e.target.result),e.onerror=e=>n(e.error)}))}function E(e,t){return new Promise(((n,r)=>{e.onsuccess=({target:e})=>{const r=e.result;r?t(r,null):n()},e.onerror=e=>r(e.error)}))}function T(t={}){const n={},{config:r,logger:o}=e();t={onError:null,activityThreshold:18e5,syncInterval:1e3,databaseName:"dba-local-buffer",...t};const i={pages:[],storedSize:0,isFirstPage:!0},a=c({maxRetries:0}),s=r.getConfig("recordingEngine.idsite"),d=`pages_${s}`;let l,u=Date.now();const g=N({databaseName:t.databaseName,databaseVersion:1,upgrades:[e=>{e.createObjectStore(d,{keyPath:"pageId"}).createIndex("siteId","siteId",{unique:!1})}]}),f=g.getObjectStore(d);function h(){return i.pages[i.pages.length-1]}async function p(){i.storedSize>m()&&await async function(){for(const e of i.pages){if(await f.get(e.pageId)){if(i.storedSize<m()&&!e.isVirtual)break;await f.delete(e.pageId),i.storedSize-=e.size}}}();for(const e of i.pages)e.lastActivity>u&&e.size<m()&&await f.put(e);u=Date.now()}function m(){return 1024*r.getConfig("recordingEngine.localBuffer.sizeLimit")*1024}return n.connectLocalBuffer=async()=>{try{if(await g.openDatabase(),g.getDatabase().objectStoreNames.contains(d)||(await g.closeDatabase(),await g.deleteDatabase(),await g.openDatabase()),await f.openCursor("readonly",(e=>{const t=e.value;i.pages.push(t),i.storedSize+=t.size,e.continue()})),i.pages.length>0){const{lastActivity:e}=h();Date.now()-e>t.activityThreshold?(o.info(`Local Buffer: the newest stored page is older than the defined activity threshold(${t.activityThreshold}ms), clearing pages table`),await f.clear()):i.isFirstPage=!1}o.log("ðŸ’¾ local buffer connected")}catch(e){o.error("Error connecting to local buffer:",e),"function"==typeof t.onError&&t.onError(e)}a.start(),l=setInterval(p,t.syncInterval)},n.deleteDatabase=async()=>{await g.deleteDatabase()},n.disconnectLocalBuffer=async()=>{a.reset(),clearInterval(l),await g.closeDatabase()},n.pushEvent=e=>{a.push((async t=>{const{compress:n,compressFirstPage:o}=r.getConfig("recordingEngine.localBuffer");!n||i.isFirstPage&&!o||(e=await v(e)),function(e){const t=function(e){return 13===e[0]}(e),n=I(e);let r;t?(r=function(e){return{pageId:e[2],siteId:s,isVirtual:Boolean(e[22]),lastActivity:null,size:I(e),events:[e]}}(e),i.pages.push(r)):(r=h(),r.events.push(e),r.size+=n);r.lastActivity=Date.now(),i.storedSize+=n}(e),t(!0)}))},n.flushToSocket=async e=>{var t;for(o.log("local buffer flushing to socket..."),a.pause(),clearInterval(l),await(t=a,new Promise((e=>{t.flush(e)})));i.pages.length>0;){const{events:t}=i.pages.shift();for(let n=0;n<t.length;n++)e.pushEvent(t[n])}await g.closeDatabase(),await g.deleteDatabase(),i.storedSize=0},n}function I(e){return"string"==typeof e&&(e=[e]),new Blob(e,{type:"text/plain"}).size}const S=String.fromCharCode(0),k=String.fromCharCode(1);function x(n,r={}){const{logger:o}=e(),i={};let a=null;const s={shouldBeConnected:!1,useLZString:!1,pingInterval:null};r={socketUrl:null,maxRetries:30,retryDelay:2e3,onConnect:null,onDisconnect:null,onError:null,onMessage:null,...r};const d=m(window,["beforeunload"]),u=c({maxRunDuration:50,onError(e){o.error("socket connector error",e),null!==r.onError&&r.onError(e)}});return i.state=t(s),i.isConnected=()=>null!==a,i.connectSocket=()=>new Promise(((e,t)=>{a?o.warn("socket connector is already connected"):l({maxRetries:r.maxRetries,retryDelay:r.retryDelay,handler:e=>{const t=new WebSocket(r.socketUrl);t.onopen=()=>{t.onopen=null,t.onerror=null,e(!0,t)},t.onerror=t=>{o.error("socket connector failed to connect",t),e(!1,t)}},onSuccess:t=>{i.handleSocketOpen(t),e()},onFail:e=>{i.handleSocketError(e),t(e)}})()})),i.handleSocketOpen=e=>{a=e,s.shouldBeConnected?o.log("ðŸ”„ socket connector reconnected"):o.log("ðŸš… socket connector connected"),d.subscribe(i.disconnectSocket),"string"==typeof a.extensions&&a.extensions.includes("permessage-deflate")||(s.useLZString=!0),i.transmitEvent("MTP/1.0\n"+S),i.state.shouldBeConnected?i.transmitEvent(b("reconnect",{PID:n.getCurrentPageId(),time:n.getPageTime()})):i.pushEvent(b("connectTime",{clientTime:Date.now(),time:n.getPageTime()})),s.shouldBeConnected=!0,s.pingInterval=setInterval((()=>{i.transmitEvent(b("ping"))}),6e4),null!==r.onConnect&&r.onConnect(a),a.onmessage=({data:e})=>i.handleSocketMessage(e),a.onclose=i.handleSocketClose,a.onerror=i.handleSocketError,u.start()},i.handleSocketMessage=e=>{e&&"string"==typeof e&&0!==e.length&&(e=e.split(k),o.debug("socket server response: "+e.join("Â·")),null!==r.onMessage&&r.onMessage(e))},i.handleSocketClose=()=>{u.pause(),a=null,null!==r.onDisconnect&&r.onDisconnect(),s.shouldBeConnected&&(o.warn("Reconnecting SocketConnector..."),i.connectSocket())},i.handleSocketError=e=>{o.error("socket connector error",e),null!==r.onError&&r.onError(e)},i.disconnectSocket=()=>{if(d.dispose(),clearInterval(s.pingInterval),u.flush(),a&&a.readyState===WebSocket.OPEN){s.shouldBeConnected=!1;try{a.close(),o.info("Disconnected socket connector")}catch(e){o.error("error while closing socket",e),null!==r.onError&&r.onError(e)}}},i.pushEvent=e=>{u.push((async t=>{s.useLZString&&(e=await v(e)),i.transmitEvent(e),t(!0)}))},i.transmitEvent=e=>{a&&a.send("string"==typeof e?e:function(e){return e.join(k)+k+S}(e))},i}function A(e,t){for(;e;){if(!1===t(e))return;e=e.parentNode}}function P(e,t=document){try{const n=t.querySelectorAll(e);return Array.from(n)}catch(e){return[]}}function O(e){let t=e.href;return"object"==typeof t&&(t=e.href.animVal||e.href.baseVal),t||""}function M(e,t){return!(!e||"object"!=typeof e||"string"!=typeof e.tagName)&&(Array.isArray(t)?t.some((t=>M(e,t))):"string"==typeof t&&e.tagName.toUpperCase()===t.toUpperCase())}function D(e){let t=e.tagName.toUpperCase();if(e===document.body||e===document.documentElement)return`//${t}`;const n=e.uwsOldParent||e.parentNode;return n?("http://www.w3.org/2000/svg"===e.namespaceURI&&(t=`*[name()="${t}"]`),`${D(n)}/${t}[${function(e){let t=1,n=e.uwsOldPrevSibling||e.previousElementSibling;for(;n;)n.tagName===e.tagName&&t++,n=n.previousElementSibling;return t}(e)}]`):`//${t}${function(e){return Array.from(e.attributes||[]).map((e=>`[@${e.name}="${e.value}"]`)).join("")}(e)}`}function R(e){return!!M(e,["textarea","option","select"])||(!(!M(e,"input")||["button","submit","reset"].includes(e.type))||!!function(e,t){return!(!e||"object"!=typeof e||!e.hasAttribute)&&e.hasAttribute(t)}(e,"contenteditable"))}function V(e){return M(e,"input")&&"password"===e.type}const L={a:8.12,b:9.61,c:12.32,d:16.64,e:28.66,f:30.96,g:32.99,h:38.91,i:46.23,j:46.33,k:47.02,l:51,m:53.61,n:60.56,o:68.24,p:70.06,q:70.17,r:76.19,s:82.47,t:91.57,u:94.45,v:95.56,w:97.65,x:97.82,y:99.93,z:100};function X(e){let t="";for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);if(r>=55296&&r<=56319&&(r=e.charCodeAt(n+1),r>=56320&&r<=57343)){t+=e.slice(n,n+2),n++;continue}let o=e[n];if(B(o)&&(o="0"),Y(o)){const e=100*Math.random();for(const t in L)if(e<=L[t]){o=o.toUpperCase()===o?t.toUpperCase():t;break}}t+=o}return t}function Y(e){return/[a-zA-Z\u00C0-\u1FFF\u2800-\uFFFD]/.test(e)}function B(e){return/\d/.test(e)}function j(e,t=null){return t instanceof RegExp?e.replace(t,((e,...t)=>{const n=t.slice(0,-2);return 0===n.length?j(e):(n.forEach((t=>{e=e.replace(new RegExp(t,"g"),j(t))})),e)})):String(e).replace(/([\s\S]*?)(&#?\w+;|$)/g,((e,t,n)=>(t=t.split("").map($).join(""))+n))}function $(e){return/\s/.test(e)?e:Y(e)?function(e){return"string"==typeof e&&e.toUpperCase()===e}(e)?"X":"x":B(e)?"0":e}async function z(){const{loader:t}=e(),[n]=await t.requireModules(["recordingEngine"]),r=n.getVirtualDOM();r.scan(),r.updateNodeConfig();const o=document.documentElement.cloneNode();H(document.documentElement.childNodes[0],o);const i=window.open("about:blank").document;i.write("<!DOCTYPE html>"+o.outerHTML),i.close(),i.querySelectorAll("textarea").forEach((e=>{e.value=e.getAttribute("value")||""})),setTimeout((()=>{const e=i.querySelector("uws-console-wrapper");e&&(e.style.visibility="hidden",e.style.pointerEvents="none")}),500)}function H(t,n){const{logger:r}=e(),o=K(t);let i;if(o)if(t.nodeType===Node.TEXT_NODE)i=document.createTextNode(o.getTextContent());else if(t.nodeType===Node.ELEMENT_NODE){i=document.createElement(t.tagName);const e=o.isMaskedText();Object.entries(o.getAttributes(e)).forEach((([e,t])=>{try{i.setAttribute(e,t)}catch(n){r.warn("Masking Preview: setAttribute failed",{node:o.node,name:e,value:t,error:n})}})),M(t,["script","iframe","embed"])&&i.removeAttribute("src"),M(t,"object")&&i.removeAttribute("data")}else i=t.cloneNode();else i=t.cloneNode(),M(t.parentNode,"style")&&(i.textContent=Q(t.parentNode));n.appendChild(i),t.firstChild&&H(t.firstChild,i),t.nextSibling&&H(t.nextSibling,n)}const W=["value","href","alt","title","placeholder"],_=["onload","onunload","onchange","onfocus","onselect","click","onmouseover","onmousemove","onmouseout","onblur","onkeydown","onkeyup","onkeypress","onenter","onsubmit","onmouseenter","onmouseleave","ontouchstart","ontouchmove","ontouchend"];function q(t={}){const n={isVNode:!0},r={node:t.node,nodeId:t.nodeId,parent:null,prevSibling:null,nextSibling:null,children:[],textContent:null,attributes:null};let o={};return n.getNode=()=>r.node,n.getNodeId=()=>r.nodeId,n.isSimulated=()=>t.simulate||!1,n.updatePosition=({parentVNode:e=null,prevSiblingVNode:t=null,nextSiblingVNode:o=null}={})=>{if(n.isSimulated())return!1;const i=r.parent?r.parent.getNodeId():null,a=r.prevSibling?r.prevSibling.getNodeId():null,s=r.nextSibling?r.nextSibling.getNodeId():null,d=e?e.getNodeId():null,l=t?t.getNodeId():null,c=o?o.getNodeId():null,u=t?t.getChildIndex()+1:0;let g=!1;return d!==i&&(r.parent=e,g=!0),l!==a&&(r.prevSibling=t,g=!0),c!==s&&(r.nextSibling=o),u!==r.childIndex&&(r.childIndex=u,g=!0),g},n.setAttribute=(e,t)=>{null===t?r.attributes.hasOwnProperty(e)&&delete r.attributes[e]:r.attributes[e]=t},n.getParent=()=>r.parent,n.getPrevSibling=()=>r.prevSibling,n.getNextSibling=()=>r.nextSibling,n.setNextSibling=e=>r.nextSibling=e,n.getChildIndex=()=>r.childIndex,n.getChildren=()=>r.children,n.resetChildren=()=>{r.children=[]},n.addChild=e=>{r.children.push(e)},n.getAttribute=(e,t=null)=>{if(!r.attributes.hasOwnProperty(e))return null;let o=r.attributes[e];return"value"===e&&["INPUT","TEXTAREA"].includes(r.node.tagName)&&(o=r.node.value),"INPUT"===r.node.tagName&&"password"===r.node.type&&"value"===e?"":(n.isMaskedAttribute(e,t)&&(o=X(o)),o)},n.getAttributes=(e=null)=>{const t={};for(const o in r.attributes)r.attributes.hasOwnProperty(o)&&(t[o]=n.getAttribute(o,e));return t},n.hasAttribute=e=>r.attributes.hasOwnProperty(e),n.getRawAttribute=e=>r.attributes.hasOwnProperty(e)?r.attributes[e]:null,n.setTextContent=e=>{r.textContent=e},n.getTextContent=()=>{if(r.parent){if(M(r.parent.getNode(),"SCRIPT"))return"";if(M(r.parent.getNode(),"STYLE"))return r.textContent}return n.isMaskedText()?X(r.textContent):r.textContent},n.getRawTextContent=()=>r.textContent,n.serialize=()=>{const{node:e,nodeId:t,attributes:o}=r,i={nT:e.nodeType,id:t};switch(e.nodeType){case Node.DOCUMENT_NODE:break;case Node.DOCUMENT_TYPE_NODE:i.name=e.name,i.publicId=e.publicId,i.systemId=e.systemId;break;case Node.ELEMENT_NODE:i.tN=e.tagName,"http://www.w3.org/2000/svg"===e.namespaceURI&&(i.ns="svg");const t=Object.keys(o);if(t.length>0){const e=n.isMaskedText(),r={};t.forEach((t=>{r[t]=n.getAttribute(t,e)})),"SCRIPT"===i.tN&&r.hasOwnProperty("src")&&delete r.src,i.at=r}break;case Node.TEXT_NODE:i.tC=n.getTextContent();break;default:i.nT=Node.COMMENT_NODE,i.tC=""}return i},n.resetNodeConfig=()=>{o={maskText:null,maskAttributes:null,anticlickmap:!1,ignoreAttributesMutation:null,ignoreTextMutation:!1,trackHover:!1}},n.updateNodeConfig=e=>{Object.assign(o,e)},n.getNodeConfig=(e,t=null)=>o.hasOwnProperty(e)?o[e]:t,n.isMaskedText=()=>{let t=n,r=0;for(;U(t);){const n=t.getNodeConfig("maskText");if(null!==n)return n;const{maskFullPage:o,maskAllInputs:i}=e().config.getConfig("recordingEngine");if(r<=1&&!o&&i&&R(t.getNode()))return!0;if(r>=250)return!0;t=t.getParent(),r++}const{config:o}=e();return o.getConfig("recordingEngine.maskFullPage")},n.isMaskedAttribute=(e,t=null)=>{let o=n.getNodeConfig("maskAttributes");return null===t&&(t=n.isMaskedText()),!!t&&(("href"!==e||!M(r.node,["BASE","LINK","IMAGE","USE"]))&&(null===o&&(o=W),o.includes(e)))},Object.defineProperty(r.node,"uwsNodeId",{value:r.nodeId,enumerable:!1,configurable:!0}),r.node.uwsVNode=n,r.node.nodeType===Node.TEXT_NODE&&(r.textContent=r.node.textContent),r.node.nodeType===Node.ELEMENT_NODE&&(r.attributes=function(e){const t={};for(let n=0;n<e.attributes.length;n++){const r=e.attributes[n];Z(e,r.name)&&(t[r.name]=r.value)}return"INPUT"===e.tagName&&(["radio","checkbox"].includes(e.type)?e.checked?t.checked="":delete t.checked:t.value=e.value),"TEXTAREA"===e.tagName&&e.value!==e.textContent&&(t.value=e.value),"OPTION"===e.tagName&&(e.selected?t.selected="":delete t.selected),e.uwsSimulateHover&&(t["mpt-hover"]=e.value),t}(r.node)),n.isSimulated()&&t.parentVNode&&(r.parent=t.parentVNode),n.resetNodeConfig(),n.updatePosition({parentVNode:t.parentVNode||null,prevSiblingVNode:t.prevSiblingVNode||null,nextSiblingVNode:t.nextSiblingVNode||null}),n}function U(e){return"object"==typeof e&&null!==e&&e.isVNode}function F(e){return e&&e.hasOwnProperty("uwsNodeId")?Number(e.uwsNodeId):null}function K(e){return e&&e.hasOwnProperty("uwsVNode")?e.uwsVNode:null}function J(e,t,n=null){return e&&e.uwsVNode?e.uwsVNode.getNodeConfig(t,n):n}function Z(e,t,n=!1){if(_.includes(t))return!1;if(n){const n=J(e,"ignoreAttributesMutation");if(Array.isArray(n)&&n.includes(t))return!1}return!0}function G(r={}){const i={},{config:a,logger:s,events:d}=e();if(!((r={rootNode:null,sanityLimit:1e3,...r}).rootNode instanceof Document))throw new Error("Invalid Argument: rootNode must be a document node");let l=null,c={},u={};const g=[],f=o(r.sanityLimit),h={lastNodeId:-1,hasChanges:!1,sanityLimitReached:!1,addedOrMovedNodes:[],deletedNodes:[],changedAttributes:{},changedTextContent:[]};return i.state=t(h),i.destroy=()=>{i.clearChanges(),c={},u={}},i.clearChanges=()=>{h.hasChanges=!1,h.addedOrMovedNodes=[],h.deletedNodes=[],h.changedAttributes={},h.changedTextContent=[],f.reset()},i.sanityLimitReached=()=>h.sanityLimitReached?(d.triggerEvent("recordingEngine:recordingError",{type:"sanityLimitReached"}),!0):!!f.limitReached()&&(h.sanityLimitReached=!0,!0),i.scan=()=>{f.start(),u=c,c={},l=i.scanNode(r.rootNode);for(const e in u){if(i.sanityLimitReached())break;if(u.hasOwnProperty(e)&&!c.hasOwnProperty(e)){const t=u[e],n=t.getParent(),r=t.getPrevSibling();if(n){if(t.isSimulated()&&!h.deletedNodes.includes(n.getNodeId()))continue;const e=t.getNode();e.uwsOldParent=n.getNode(),e.uwsOldPrevSibling=r?r.getNode():null}h.deletedNodes.push(Number(e)),h.hasChanges=!0}}},i.scanNode=(t,n={})=>{if(i.sanityLimitReached())return null;const{parentVNode:r=null,prevSiblingVNode:o=null,nextSiblingVNode:s=null,simulate:d=!1}=n,{firstChild:l,nextSibling:g}=t;let f=F(t),p=null!==f&&u[f];const m=!p;if(m&&(f=++h.lastNodeId,p=q({node:t,nodeId:f,parentVNode:r,prevSiblingVNode:o,nextSiblingVNode:s,simulate:d}),h.addedOrMovedNodes.push({nodeId:f,isNew:!0})),c[f]=p,p.resetChildren(),r&&r.addChild(p),o&&o.setNextSibling(p),m||p.updatePosition({parentVNode:r,prevSiblingVNode:o,nextSiblingVNode:s})&&h.addedOrMovedNodes.push({nodeId:f,isNew:!1}),"STYLE"!==t.tagName||t.textContent&&!a.getConfig("recordingEngine.simulateStyleGlobal"))l&&i.scanNode(l,{parentVNode:p});else{const t=function(t,n){if(n.simulatedStyleTextNode)return n.simulatedStyleTextNode;const r=n.getNode(),o=document.createTextNode(Q(r));let i;const a=()=>{try{clearTimeout(i),i=setTimeout((()=>{const e=t.getVNode(o);t.registerTextChange(e,Q(r))}),100)}catch(t){const{logger:n}=e();n.error("Error while simulating style mutations")}},s=r.sheet.deleteRule;s&&(r.sheet.deleteRule=(...e)=>{s.apply(r.sheet,e),a()});const d=r.sheet.removeRule;d&&(r.sheet.removeRule=(...e)=>{d.apply(r.sheet,e),a()});const l=r.sheet.insertRule;l&&(r.sheet.insertRule=(...e)=>{l.apply(r.sheet,e),a()});const c=r.sheet.addRule;c&&(r.sheet.addRule=(...e)=>{c.apply(r.sheet,e),a()});return n.simulatedStyleTextNode=o,o}(i,p);i.scanNode(t,{parentVNode:p,isSimulated:!0})}return g&&i.scanNode(g,{parentVNode:r,prevSiblingVNode:p}),p},i.getRootNode=()=>r.rootNode,i.getVNode=e=>i.getVNodeById(F(e)),i.getVNodeById=e=>c[e]||null,i.registerNodeChange=()=>h.hasChanges=!0,i.hasChanges=()=>h.hasChanges,i.getCurrentSnapshot=()=>c,i.getSanityTracker=()=>f,i.addNodeConfig=(e,t)=>{g.push({selector:e,nodeConfig:t})},i.updateNodeConfig=()=>{if(i.hasChanges()){for(const e in c)c.hasOwnProperty(e)&&c[e].resetNodeConfig();g.forEach((({selector:e,nodeConfig:t})=>{i.selectVNodes(e,(e=>{"function"==typeof t&&(t=t(e)),"object"==typeof t&&null!==t&&e.updateNodeConfig(t)}))}))}},i.selectVNodes=(e,t)=>{P(e).forEach((e=>{const n=i.getVNode(e);n&&t(n)}))},i.registerAttributeChange=(e,t,n)=>{if(!U(e)||!Z(e.getNode(),t,!0))return;if(null===n&&!e.hasAttribute(t))return;if(n===e.getRawAttribute(t))return;e.setAttribute(t,n);const r=e.getNodeId();h.changedAttributes.hasOwnProperty(r)?h.changedAttributes[r].includes(t)||h.changedAttributes[r].push(t):h.changedAttributes[r]=[t],h.hasChanges=!0},i.registerTextChange=(e,t)=>{if(!U(e)||e.getNodeConfig("ignoreTextMutation"))return;if(t===e.getRawTextContent())return;const n=e.getNodeId();e.setTextContent(t),h.changedTextContent.includes(n)||h.changedTextContent.push(n),h.hasChanges=!0},i.getSerializedSnapshot=async()=>{if(null===l)return{};const e=[l],t={};return n({maxRunTasks:1e3,maxRunDuration:50,task(n){const r=e.shift(),o=r.getNodeId(),i=r.serialize();t[o]=i;const a=r.getParent();a&&t[a.getNodeId()].cN.push(i);const s=r.getChildren();s.length>0&&(e.push(...s),i.cN=[]),0===e.length&&n(t[l.getNodeId()])}})},i.getMutationData=()=>{if(i.sanityLimitReached())return{};const e={am:[],r:[],at:[],t:[]};h.deletedNodes.forEach((t=>e.r.push(t))),h.addedOrMovedNodes.forEach((({nodeId:t,isNew:n})=>{const r=c[t],o=n?r.serialize():{id:t},i=r.getParent();i?o.pN={id:i.getNodeId()}:(o.pN={id:null},s.warn("vnode tracker: vNode has no parent",r));const a=r.getPrevSibling();a&&(o.pS={id:a.getNodeId()}),e.am.push(o)}));for(const t in h.changedAttributes){const n=c[t];if(n){const r={},o=n.isMaskedText();h.changedAttributes[t].forEach((e=>{r[e]=n.getAttribute(e,o)})),e.at.push([n.getNodeId(),r])}}return h.changedTextContent.forEach((t=>{const n=c[t];n&&e.t.push([t,n.getTextContent()])})),0===e.am.length&&delete e.am,0===e.r.length&&delete e.r,0===e.at.length&&delete e.at,0===e.t.length&&delete e.t,e},i}function Q(t){let n=[];try{t.sheet&&t.sheet.cssRules?n=Array.from(t.sheet.cssRules):t.sheet&&t.sheet.rules&&(n=Array.from(t.sheet.rules))}catch(n){const{logger:r}=e();r.warn("Could not parse css rules of node: "+t)}return n.map((e=>e.cssText)).join("\n")}function ee(e,t){t={diffInterval:500,rootNode:document,...t};const n=new MutationObserver(function(e){return t=>{Array.from(t).forEach((({type:t,target:n,attributeName:r})=>{const o=e.getVNode(n);o&&("characterData"===t?e.registerTextChange(o,n.textContent):"attributes"===t?e.registerAttributeChange(o,r,n.getAttribute(r)):e.registerNodeChange())}))}}(e)),r=function(e,t){let n=!1,r=null;const o=async i=>{await e(i),n&&(r=setTimeout(o,t,i))};return{isRunning:()=>n,start:e=>{n=!0,r=setTimeout(o,0,e)},stop:()=>{clearTimeout(r),r=null,n=!1}}}(function(e,t){return n=>{if(e.scan(),e.updateNodeConfig(),e.sanityLimitReached())n.dispose();else{if(e.hasChanges()){const r=JSON.stringify(e.getMutationData()),o=I(r),i=t.lastMutationId+1;t.lastMutationId=i,n.next({event:"mutation",data:{mutationData:r,mutationId:i,mutationSize:o}})}e.clearChanges()}}}(e,{lastMutationId:0}),t.diffInterval),o=g((async i=>{if(e.scan(),e.sanityLimitReached()){const e=await async function(e){const t=new Document,n=t.createElement("html");n.innerHTML=`<head></head><body>${e}</body>`,t.appendChild(n);const r=G({rootNode:t});return r.scan(),JSON.stringify(await r.getSerializedSnapshot())}("Background could not be recorded");return void i({event:"snapshot",data:{snapshot:e,snapshotSize:I(e)}})}e.updateNodeConfig(),e.clearChanges(),n.observe(t.rootNode,{subtree:!0,childList:!0,attributes:!0,characterData:!0});const a=JSON.stringify(await e.getSerializedSnapshot());return i({event:"snapshot",data:{snapshot:a,snapshotSize:I(a)}}),r.start(o),()=>{n.disconnect(),r.stop()}}));return o.mutationObserver=n,o.diffInterval=r,o}function te(){return p(p(m(document,["load"]).pipe(h((()=>({event:"load",data:{eventType:"load"}})))),m(document,["pageshow"]).pipe(h((()=>({event:"load",data:{eventType:"pageshow"}})))),m(document,["pagehide"]).pipe(h((()=>({event:"pagehide"}))))),ne(),p(m(document,["visibilitychange"]),m(window,["focus","blur"])).pipe(y(500),h((()=>({event:"tabFocus",data:{jsonData:{hasFocus:document.hasFocus(),isVisible:"visible"===document.visibilityState}}})))))}function ne(){return g((async e=>{const t=()=>{const t={domLoadTime:re()};e({event:"domLoaded",data:{jsonData:t}})};return["complete","loaded"].includes(document.readyState)&&t(),m(window,["load"]).subscribe(t)}))}function re(){const[e]=performance.getEntriesByType("navigation");return Math.round(e.domComplete)}function oe(){return(void 0!==performance.timeOrigin?Math.round(performance.timeOrigin):performance.timing.navigationStart)+re()}function ie({isMobile:e}){const t=[];return e?(t.push(function(){const e={client:{width:se(),height:de()}};return p(m(window,["orientationchange","resize","focus","blur"]),m(document,["touchend","scroll"])).pipe(y(500),f((()=>e.client.width!==se()||e.client.height!==de())),h((()=>(e.client.width=se(),e.client.height=de(),{event:"scaleChange",data:{clientWidth:e.client.width,clientHeight:e.client.height,pageYOffset:window.pageYOffset,pageXOffset:window.pageXOffset}}))))}()),t.push(m(window,["orientationchange"]).pipe(h((()=>({event:"orientationChange",data:{orientation:ae()}})))))):t.push(g((e=>{const t={client:{width:se(),height:de()},window:{width:window.innerWidth,height:window.innerHeight}};return m(window,["resize"]).subscribe((()=>{const n={width:se(),height:de()},r={width:window.innerWidth,height:window.innerHeight};t.client.width===n.width&&t.client.height===n.height||(e({event:"resize",data:{clientWidth:n.width,clientHeight:n.height,windowWidth:r.width,windowHeight:r.height,deltaClientWidth:n.width-t.client.width,deltaClientHeight:n.height-t.client.height,deltaWindowWidth:r.width-t.window.width,deltaWindowHeight:r.height-t.window.height}}),t.client=n,t.window=r)}))}))),p(...t)}function ae(){return screen.orientation?screen.orientation.angle:window.orientation}function se(){return document.documentElement.clientWidth}function de(){return document.documentElement.clientHeight}function le(){const e=m(document,["scroll"],[!0]);return p(function(e){return g((t=>{let n={left:ge(),top:ue()};return e.subscribe((()=>{const e={left:ge(),top:ue()},r=e.left-n.left,o=e.top-n.top;n=e,t({event:"scroll",data:{deltaLeft:r,deltaTop:o}})}))}))}(e),function(e){return e.pipe(((e,t)=>{const{target:n}=e;if(n.nodeType===Node.ELEMENT_NODE)return t({event:"elementScroll",data:{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop,nodeId:n.uwsNodeId||0,xPath:n.hasOwnProperty("uwsNodeId")?D(n):null}})}))}(e),function(e){return g((t=>{const n=50;let r=he(n);return t({event:"areaVisibility",data:r}),e.pipe(y(500)).subscribe((()=>{const e=he(n);e.firstArea===r.firstArea&&e.countAreas===r.countAreas||(r=e,t({event:"areaVisibility",data:e}))}))}))}(e),function(e){return g((t=>{let n=ce().scrollHeight;return e.pipe(y(500)).subscribe((()=>{const e=ce().scrollHeight;e>n&&(n=e,t({event:"scrollHeight",data:{maxScrollHeight:n}}))}))}))}(e))}function ce(){return document.scrollingElement||document.body.parentNode||document.body||document.documentElement}function ue(){const e=ce().scrollHeight-window.innerHeight;return Math.max(0,Math.min(ce().scrollTop,e))}function ge(){const e=ce().scrollWidth-window.innerWidth;return Math.max(0,Math.min(ce().scrollLeft,e))}function fe(){let e=!1;try{e=window.frameElement&&window.frameElement.scrolling&&"no"===window.frameElement.scrolling}catch(e){}return e}function he(e){const t=ue(),n=Math.ceil(t/e);return{firstArea:n,countAreas:Math.floor((t+de())/e)-1-n+1}}function pe({target:e,keyCode:t,key:n=""}){if(n=String(n),"INPUT"===e.tagName&&"password"===e.type)return{keyCode:106,key:"*"};const r=K(e);if(r&&!r.isMaskedText())return{keyCode:t,key:n};const o=$(n);return o!==n&&(t=B(n)?48:88,n=o),{keyCode:t,key:n}}function me({ctrlKey:e,altKey:t,shiftKey:n,metaKey:r}){return(e?1:0)+(t?2:0)+(n?4:0)+(r?8:0)}function ye(){return m(document,["mousedown"]).pipe(((e,t)=>{const{pageX:n,pageY:r,target:o,button:i}=e,a=be(e);t({event:"mousedown",data:{buttonId:we(i),modKey:me(e),pageX:Math.round(n),pageY:Math.round(r),tagName:o.tagName,id:o.id,href:O(o),anticlickmap:Ee(o,a),xpath:D(o),position:`${a.relLeft},${a.relTop}`,dimensions:`${a.width},${a.height}`,dimensionPath:Ne(o),nodeId:o.uwsNodeId}})}))}function we(e){return 1==+e?4:e}function be({target:e,clientX:t,clientY:n}){const{width:r,height:o,left:i,top:a}=ve(e);return{width:r,height:o,left:i,top:a,relLeft:Math.round(t-i),relTop:Math.round(n-a)}}function ve(e){const{height:t,width:n,left:r,top:o}=e.getBoundingClientRect();return{left:Math.round(r),top:Math.round(o),height:Math.round(t),width:Math.round(n)}}function Ne(e){const t=[];let n=e;for(;n&&n!==document;){const e=n.hasOwnProperty("uwsOldParent")?n.uwsOldParent:n.parentNode;t.unshift({node:n,rect:ve(n)}),n=e}return t.map((({rect:e},n)=>{const r=t[n-1],o=r?r.rect:null;let i=0,a=0,s=1,d=0;return o&&(i=e.left-o.left,a=e.top-o.top,o.width>0&&e.width>0&&(s=e.width/o.width,d=(o.left+.5*o.width-(.5*e.width+e.left))/(.5*e.width))),[e.width,e.height,e.left,e.top,i,a,Ce(s,5),Ce(d,5)].join(";")})).join("/")}function Ce(e,t){return e%1==0?e:parseFloat(e.toFixed(t))}function Ee(e,t){if(t.relTop<-4||t.relTop>t.height+4)return!0;if("OPTION"===e.tagName)return!0;let n=!1;return A(e,(e=>{if(J(e,"anticlickmap"))return n=!0,!1})),n}function Te(){return p(ye(),function(){const e=new Map;return p(m(document,["touchstart"]).pipe(Ie,((t,n)=>{e.set(t.finger.identifier,t.finger),n(t)})),m(document,["touchmove"]).pipe(Ie,((t,n)=>{(function(e,t){const n=t.get(e.identifier);return!n||e.screenX!==n.screenX||e.screenY!==n.screenY})(t.finger,e)&&(e.set(t.finger.identifier,t.finger),n(t))})),m(document,["touchend","touchcancel"]).pipe(Ie,((t,n)=>{e.has(t.finger.identifier)&&(e.delete(t.finger.identifier),n(t))})))}().pipe(h((({finger:e,event:t})=>{const n={fingerId:e.identifier,screenX:Math.round(e.screenX),screenY:Math.round(e.screenY),pageX:Math.round(e.pageX),pageY:Math.round(e.pageY),clientX:Math.round(e.clientX),clientY:Math.round(e.clientY)};if("touchstart"===t.type){const t=be({target:e.target,clientX:e.clientX,clientY:e.clientY});n.force=Math.round(100*(e.force||0)),n.angle=e.rotationAngle||0,n.radiusX=Math.round(e.radiusX||0),n.radiusY=Math.round(e.radiusY||0),n.tagName=e.target.tagName,n.id=e.target.id,n.href=O(e.target),n.anticlickmap=+Ee(e.target,t),n.xpath=D(e.target)}return"touchmove"===t.type&&(n.force=Math.round(100*(e.force||0)),n.angle=e.rotationAngle||0,n.radiusX=Math.round(e.radiusX||0),n.radiusY=Math.round(e.radiusY||0)),{event:t.type,data:n}}))))}function Ie(e,t){Array.from(e.changedTouches||[]).forEach((n=>t({event:e,finger:n})))}function Se(){return p(m(document,["focus"],!0).pipe(((e,t)=>{if(!R(e.target)||V(e.target))return;const n=function({target:e}){const t={fieldId:e.getAttribute("id")||"",fieldName:e.getAttribute("name")||"",fieldMptId:Ae(e)||null,fieldValue:Oe(e),fieldType:e.type,formId:null,formName:null,formMptId:null,tagName:e.tagName,XPath:D(e),nodeId:F(e)},n=e.form;n&&(t.formId=n.getAttribute("id")||"",t.formName=n.getAttribute("name")||"",t.formMptId=Pe(n)||null);return t}(e);(n.fieldId||n.fieldName||n.fieldMptId)&&t({event:"focus",data:n})})),m(document,["blur"],!0).pipe(((e,t)=>{R(e.target)&&!V(e.target)&&t({event:"blur",data:ke(e)})})),m(document,["change"],!0).pipe(((e,t)=>{if(!R(e.target)||V(e.target))return;t({event:"change",data:xe(e)});const n=function({target:e}){return{nodeId:F(e)}}(e);n.nodeId&&t({event:"fieldChange",data:{jsonData:n}})})))}function ke({target:e}){return{fieldValue:Oe(e),nodeId:F(e)}}function xe({target:e}){const t={fieldId:e.getAttribute("id")||"",fieldName:e.getAttribute("name")||"",fieldMptId:Ae(e)||null,fieldValue:Oe(e),formId:null,formName:null,formMptId:null,tagName:e.tagName},n=e.form;return n&&(t.formId=n.getAttribute("id")||"",t.formName=n.getAttribute("name")||"",t.formMptId=Pe(n)||null),t}function Ae(e){let t=e.getAttribute("mptid");if(t)return t;const n=e.form||null,r=n?n.elements:document.getElementsByTagName(e.tagName),o=Array.from(r).findIndex((t=>t===e));return~o?(t=`${e.tagName};${Pe(n)};${o}`,e.setAttribute("mptid",t),t):null}function Pe(e){if(!e)return null;const t=e.getAttribute("mptid"),{id:n,name:r}=e;if(t)return`mptid:${t}`;if(r)return`name:${r}`;if(n)return`id:${n}`;const o=Array.from(document.forms).findIndex((t=>e===t));return~o?(e.setAttribute("mptid",o),`mptid:${o}`):null}function Oe(e){if(!R(e))return null;const{type:t,value:n,checked:r}=e;return"checkbox"===t?+r:"password"===t?"":"select-one"===t||"select-multiple"===t?"0":j(n)}function Me(t){const{config:n}=e(),r=n.getConfig("global.moduleHost");return!t.filename||!t.filename.includes(r)}function De(e){return p(m(e.getRootNode(),["change"]).pipe((({target:t})=>{const n=e.getVNode(t);if(n){if("INPUT"===t.tagName&&"checkbox"===t.type&&e.registerAttributeChange(n,"checked",t.checked?"":null),"INPUT"===t.tagName&&"radio"===t.type){const n=Array.from(document.querySelectorAll(t.name?`input[name="${t.name}"]`:null));n.unshift(t),n.forEach((t=>{const n=e.getVNode(t);n&&e.registerAttributeChange(n,"checked",t.checked?"":null)}))}"SELECT"===t.tagName&&Array.from(t.options).forEach((t=>{const n=e.getVNode(t);n&&e.registerAttributeChange(n,"selected",t.selected?"":null)}))}})),m(e.getRootNode(),["input"]).pipe((({target:t})=>{const n=e.getVNode(t);if(n)return M(t,"textarea")?e.registerAttributeChange(n,"value",t.value):void(M(t,"input")&&["text","email","number","search"].includes(t.type)&&e.registerAttributeChange(n,"value",t.value))})))}function Re(n){const{logger:r,config:o,storage:i,events:a}=e(),s={},d=function(){const{status:e="initial",conditional:t=null,recordingType:n=null,sessionActivated:r=!1}=i.getStorageItem("recording",{defaultValue:{}});return{initialized:!1,status:e,conditional:t,recordingType:n,sessionActivated:r,collectionStarted:!1,domloadTime:null,pauseReason:"",enabled:o.getConfig("recordingEngine.enabled")}}();s.state=t(d);const l=x(n,{socketUrl:Ve(n.getVisitorId()),maxRetries:30,retryDelay:2e3,onMessage(e){if("7"===e[0]){const t=e.length>2&&!isNaN(e[2])&&!!+e[2];s.stopRecording(t)}}}),c=T({onError:e=>{a.triggerEvent("recordingEngine:recordingError",{type:"localBufferError",errorMessage:e}),C.transitionToServer()}}),u=G({rootNode:document,sanityLimit:o.getConfig("recordingEngine.domSanityLimit")});let g=null,b=null;const v=[ee(u,{diffInterval:o.getConfig("recordingEngine.mutationDiffInterval")}),De(u),Se(),te(),ie({isMobile:"desktop"!==n.getDeviceType()}),le(),m(window,["error"]).pipe(f(Me),h((e=>({event:"scriptErrors",data:{jsonData:{type:"error",message:e.message,line:e.lineno+":"+e.colno,scriptUrl:e.filename}}}))))],N=o.getConfig("recordingEngine.trackHover");Array.isArray(N)&&N.length>0&&v.push(function(e){const t=e.getRootNode(),n=new Set;return p(m(t,["mouseover"]).pipe((t=>{A(t.target,(t=>{const r=e.getVNode(t);r&&r.getNodeConfig("trackHover")&&!n.has(r.getNodeId())&&(n.add(r.getNodeId()),e.registerAttributeChange(r,"mpt-hover",""))}))})),m(t,["mouseout"]).pipe((t=>{A(t.target,(r=>{const o=e.getVNode(r);if(!o||!n.has(o.getNodeId()))return;const i=t.relatedTarget||t.toElement;(function(e,t){for(;e;){if(e.parentNode===t)return!0;e=e.parentNode}return!1})(i,r)||i===r||(e.registerAttributeChange(o,"mpt-hover",null),n.delete(o.getNodeId()))}))})))}(u)),o.getConfig("recordingEngine.recordKeyEvents")&&v.push(m(document,["keydown"]).pipe(f((e=>{const t=[16,17,18,91,93,224].includes(e.keyCode),n="INPUT"===e.target.tagName&&"password"===e.target.type;return!t&&!n})),h((e=>({event:"keydown",data:{modKey:me(e),...pe(e)}}))))),Xe()?(v.push(Te()),v.push(m(document,["gesturestart","gesturechange","gestureend"]).pipe(h((({type:e,scale:t,rotation:n,target:r})=>({event:e,data:{scale:t,rotation:n,tagName:r.tagName,id:r.id}})))))):(v.push(p(n.getPageChangeObservable(),m(document,["mousedown","mousemove"]).pipe(((e,t)=>{t({event:"mousemove",data:{buttonId:we(e.button),modKey:me(e),pageX:e.pageX,pageY:e.pageY}})}))).pipe(function(){const e={pageX:0,pageY:0};return(t,n)=>{if("pageChange"===t.type)return e.pageX=0,void(e.pageY=0);const{pageX:r,pageY:o}=t.data;r===e.pageX&&o===e.pageY||(t.data.pageX=Math.round(r-e.pageX),t.data.pageY=Math.round(o-e.pageY),e.pageX=r,e.pageY=o,n(t))}}())),v.push(ye()));const C=w({socketConnector:l,localBuffer:c,visitor:n,tracker:v});function E(e){C.collectEvent({event:"activateSession",data:{recordingType:e}}),I({conditional:!1,recordingType:e,sessionActivated:!0}),r.log("âœ” activated session recording"),a.triggerEvent("recordingEngine:recordingActivated",{recordingEngine:s})}function I(e){Object.assign(d,e);const{status:t,conditional:n,sessionActivated:r,recordingType:o}=d;i.setStorageItem("recording",{status:t,conditional:n,sessionActivated:r,recordingType:o},{expiry:"session_timeout"})}function S(){const{version:t}=e(),r={charset:document.characterSet,client_height:de(),is_iframe:+(parent!=window),is_mutation_stream:1,is_scrolling_disabled:+fe(),initial_referer:n.getInitialReferrer()||"",orientation:ae(),prev_pageid:n.getPreviousPageId()||0,custom_scrolling_element_xpath:null,scroll_left:ge(),conditional_import:d.conditional,sdkType:"unified-websdk",rateComparator:n.getRateComparator()};return{revision:102,idsite:o.getConfig("recordingEngine.idsite"),VID:n.getVisitorId(),PID:n.getCurrentPageId(),starttime:n.getPageStarted(),pagename:n.getCurrentPagename(),virtualPi:d.collectionStarted,url:n.maskUrl(location.href),referer:n.maskUrl(document.referrer),ua:navigator.userAgent,locale:navigator.language,domloadTime:oe(),versions:`unified-websdk: ${t} | config: ${o.getConfig("global.updatedAt")}`,clientWidth:se(),scrollHeight:ce().scrollHeight,scrollWidth:Math.max(document.body.scrollWidth,document.documentElement.scrollWidth),scrollTop:ue(),viewport:window.innerWidth+"x"+window.innerHeight,res:screen.width+"x"+screen.height,outerViewport:(window.outerWidth||0)+"x"+(window.outerHeight||0),availableViewport:screen.availWidth+"x"+screen.availHeight,isTouch:Xe(),extendedProperties:JSON.stringify(r),trackingPersistence:"visit",debugMessages:"",flashVer:0,enginePolls:0}}return s.getVirtualDOM=()=>u,s.getEventProcessor=()=>C,s.getSocketConnector=()=>l,s.getLocalBuffer=()=>c,s.showMaskingPreview=z,s.addNodeConfig=u.addNodeConfig,s.start=()=>{const{maskingRules:e,unmaskingRules:t,trackHover:r}=o.getConfig("recordingEngine");e.forEach((e=>{u.addNodeConfig(e.fullPage?"html":e.selector,(()=>{if(n.evaluateConditions(e.matchAll,e.conditions||[]))return{maskText:!0}}))})),t.forEach((e=>{u.addNodeConfig(e.fullPage?"html":e.selector,(()=>{if(n.evaluateConditions(e.matchAll,e.conditions||[]))return{maskText:!1}}))})),u.addNodeConfig("[mpt-anon], .uws-mask, [uws-mask]",{maskText:!0}),u.addNodeConfig(".fsrVisible, [mpt-visible], .uws-unmask, [uws-unmask]",{maskText:!1}),Array.isArray(r)&&r.forEach((e=>{u.addNodeConfig(e,{trackHover:!0})})),u.registerNodeChange(),u.updateNodeConfig();const d=i.getStorageItem("uws_recording");["recording","paused"].includes(d?.status)&&s.startRecording({conditional:d?.conditional}),a.triggerEvent("recordingEngine:ready",{recordingEngine:s})},s.startRecording=async({conditional:e=!1}={})=>{d.enabled?"stopped"!==d.status?d.initialized?!e&&d.conditional&&s.activateSession("default"):null!==o.getConfig("recordingEngine.idsite")?(!1===d.conditional&&(e=!1),I({initialized:!0,conditional:e}),o.getConfig("recordingEngine.waitForDOMLoad")&&await new Promise((e=>{const t=ne();t.subscribe((()=>{e(),t.dispose()}))})),g=n.getPageChangeObservable().subscribe(s.newPI),b=n.getPropertyObservable().pipe(y(1)).subscribe((e=>{e.find((e=>e.changePage))||"recording"!==d.status||e.forEach((e=>Le(C,e)))})),null!==n.getCurrentPageId()&&await s.newPI(),a.triggerEvent("recordingEngine:recordingStarted",{recordingEngine:s})):r.warn("Cannot start recording. Idsite is 'null'. Please enter a valid idsite in the config file."):r.warn("Cannot start recording. Recording Engine is stopped"):r.warn("Cannot start recording. Recording Engine is disabled.")},s.stopRecording=async(e=!1)=>{d.initialized&&"recording"===d.status&&(I({initialized:!1,status:e?"stopped":"initial"}),g&&(g(),g=null),b&&(b(),b=null),await C.stopEventCollection(),r.log("ðŸ›‘ stopped session recording"),a.triggerEvent("recordingEngine:recordingStopped",{recordingEngine:s}))},s.activateSession=async(e="default")=>{return d.enabled&&"stopped"!==d.status?d.sessionActivated?(r.info("Activate Session: Session is already activated."),!1):void("recording"===d.status?(await(t=()=>d.collectionStarted,new Promise((e=>{const n=setInterval((()=>{t()&&(e(!0),clearInterval(n))}),100)}))),await C.transitionToServer(),E(e)):(I({conditional:!1,recordingType:e,sessionActivated:!1}),r.log("Activate Session: Current page does not allow recording. Session will be activated on next allowed page."))):(r.warn("Activate Session: Cannot activate session. Recording is disabled."),!1);var t},s.getDebugData=()=>d,s.newPI=async()=>{n.getProperties().forEach((e=>{n.getPageManager().evaluateProperty(e)}));const t=function(){if(function(t){const{config:n}=e(),{blacklist:r}=n.getConfig("recordingEngine"),o=!1;if(0===r.length)return!1;return t.evaluateConditions(o,r)}(n))return"blacklisted page";if(!function(t){const{config:n}=e(),{whitelist:r}=n.getConfig("recordingEngine"),o=!1;if(0===r.length)return!0;return t.evaluateConditions(o,r)}(n))return"not in whitelist";if(function(){const{config:t}=e(),{stopOnTranslation:n}=t.getConfig("recordingEngine");if(!n)return!1;return null!==document.querySelector(".translated-ltr, .translated-rtl")}())return"google translated";if(null===n.getCurrentPagename())return"unmapped pagename";return""}();if(t)return d.collectionStarted&&(await C.stopEventCollection(),d.collectionStarted=!1),I({status:"paused",pauseReason:t}),r.log(`â¸ session recording is paused (${t})`),void a.triggerEvent("recordingEngine:recordingPaused",{recordingEngine:s});if(C.collectEvent({event:"initPage",data:S()}),n.getProperties().forEach((e=>Le(C,e))),!d.collectionStarted){const e=d.conditional&&o.getConfig("recordingEngine.localBuffer.enabled");I({status:"recording",collectionStarted:!0,pauseReason:""}),await C.startEventCollection({useBuffer:e}),r.log("ðŸŽ¥ started session recording",{useBuffer:e});const{recordingType:t,sessionActivated:n}=d;t&&!n&&E(t)}},s}function Ve(t){const{config:n}=e(),r=n.getConfig("servers.dbaHoover");return`wss://${r.host}${r.wsEndpoint}?vid=${t}`}function Le(e,t){null!==t.value&&void 0!==t.value&&(Array.isArray(t.value)?t.value.forEach((n=>Le(e,{...t,value:n}))):e.collectEvent({event:"property",data:{name:t.name,value:t.value,dataType:t.dataType,scope:t.session?0:2,unique:!t.multiple}}))}function Xe(){return"ontouchstart"in document}const{loader:Ye}=e();Ye.resolveModule("recordingEngine",(async()=>{const[e]=await Ye.requireModules(["visitor"]);return Re(e)}))})();